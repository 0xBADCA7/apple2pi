NEW

REM LOAD PIDRIVE AND APPLY FIXUPS

300  PRINT  CHR$ (4);"BLOAD PIDRIVE.A2DRVR"
310  VE = 816 : FX = VE + 4 : SI = PEEK(768) : SN = SI / 8

REM CHECK IF PRODOS DEVICE VECTOR SET

320  IF PEEK(48913 + SN) = 222 THEN POKE 48912 + SN, PEEK(VE) : POKE 48913 + SN, PEEK (VE + 1)
330  IF PEEK(48929 + SN) = 222 THEN POKE 48928 + SN, PEEK(VE) : POKE 48929 + SN, PEEK (VE + 1)
340  FOR D = 48946 TO 48959
350  IF PEEK (D) = 0 THEN POKE D, SI + 1 : POKE 48945, PEEK (48945) + 1 : D = 48960
360  NEXT
370  FOR D = 48946 TO 48959
380  IF PEEK (D) = 0 THEN POKE D, SI + 1 : POKE 48945, PEEK (48945) + 129 : D = 48960
390  NEXT
395  PRINT "PIDRIVE CONNECTED ON SLOT #"; SN / 2 

REM INSERT CLOCK DRIVER

400 POKE 48903, PEEK (VE + 2) : POKE 48904, PEEK (VE + 3)
405 PRINT "PICLOCK CONNECTED"

REM RUN THROUGH FIXUP TABLE

410 AA = PEEK (FX) : IF AA = 0 THEN NEW : END
420 AA = AA + PEEK (FX + 1) * 256 : FX = FX + 2
430 POKE AA, PEEK (AA) + SI
440 GOTO 410

]